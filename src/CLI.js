// Current location tells the game what variable to look inside of

theMap=[
    {pageName:"baseLayer",
        content:"",
        upstream:[
            {pageName:"globalParksInitiative",
                content:"<p>Welcome to the file access system for the Global Parks Initiative\nWhat are you searching for today?</p>",
                commandLine:'[Admin@7.3.55.8][GPI_Base]: ',
                upstream:[
                    {pageName:"northCascades",
                        content:"<p>Currently searching for files regarding the Northern Cascades</p>",
                        commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades: ',
                        upstream:[
                            {pageName:"entities",
                                content:"<p>Now searching for files regarding the entities of the Northern Cascades</p><p id='error'>HIDDEN FILES DETECTED</p>",
                                commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities: ',
                                upstream:[
                                    {pageName:"theRootedOne",
                                        content:"<br><p>The Rooted One of the North Cascades is an ancient and enigmatic force of nature that embodies decay, rot, and the relentless march of natural entropy. It is considered an elder entity, wielding a power whose depth remains largely unknown. This entity is capable of psychic communication/infection and appears to have the ability to generate new life forms from the organic detritus that accumulates within its domain. These emergent beings are often unpredictable and dangerous, capable of venturing beyond The Rooted One's immediate boundaries to inflict chaos upon nearby human settlements; especially Marble Basin.</p><p>Vigilant monitoring and scientific study are highly recommended at this time.</p>",
                                        commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities/theRootedOne: ',
                                        upstream:[
                                            {pageName:"containment",
                                                content:"<br>The Rooted One has proven itself to be a rather simple entity to contain due to its deep connection to the North Cascades and its slow rate of growth. The rate of its spread is well within acceptable parameters. The creatures that it creates, however, have proven themselves more challenging to contain/eliminate, though the local therianthropic clan/cult/coven has proven effective at culling the entities as they crop up. If total containment were necessary, a wildfire could be an effective means to halt any progress made in the past decades.</p><div id='rooted'><p>You cling to life, to hope, to fleeting moments of beauty</p><p>I offer the truth beneath your illusions</p><p>Nothing lasts. Nothing can be held.</p></div>",
                                                commandLine:'[ROOT@7.3.55.8][GPI_Base]northCascades/entities/theRootedOne/containment: ',
                                                upstream:[]
                                            },
                                            {pageName:"communication",
                                                content:"<br><p>The Rooted One possesses the ability to communicate psychically, often through disturbing and horrifying means. Those who attempt to engage with it mentally risk developing symptoms of wood rot, which gradually distort their physical form into grotesque, inhospitable shapes. This process is particularly severe in humans, although some supernatural entities with a shared affinity for wild magic exhibit greater resistance, likely due to their inherent magical resilience.</p>",
                                                commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities/theRootedOne/communication: ',
                                                upstream:[]
                                            },
                                            {pageName:"scope",
                                                content:"<br><p>The influence of The Rooted One extends across the entire Northern Cascades, making it a significant concern for regional security. To mitigate its impact, it is recommended to maintain a steady influx of drifters—individuals who can serve as sacrificial offerings—to distract The Rooted One and prevent it from expanding further into critical areas. This strategy aims to contain the threat while minimizing risk to essential personnel.</p>",
                                                commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities/theRootedOne/scope: ',
                                                upstream:[]
                                            },
                                            {pageName:"realityManipulation",
                                                content:"<br><p>Beyond its biological and psychic capabilities, The Rooted One can manipulate reality within its domain. It creates vast, seemingly endless caverns, towering mountains, and dense, labyrinthine trails that challenge any who ventures into its territory. These altered landscapes are perilous and escape often requires the use of extrasensory devices or advanced magical tools. However, prolonged exposure to The Rooted One's domain only amplifies its brutality and horror, making escape increasingly difficult and dangerous when longer expeditions are undertaken.</p>",
                                                commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities/theRootedOne/realityManipulation: ',
                                                upstream:[]
                                            },
                                            {pageName:"conductors",
                                                content:"<br><p>Propositions to involve local Wild Magic conductors have been evaluated but ultimately rejected. The primary concerns are that these conductors may pose additional threats or lack the necessary expertise, rendering them ineffective or even counterproductive. Nonetheless, this approach remains open for reconsideration should circumstances change or new information emerge about their potential utility in managing The Rooted One's influence.</p>",
                                                commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities/theRootedOne/conductors: ',
                                                upstream:[]
                                            }
                                        ],
                                    }
                                ],
                                hidden:[
                                    {pageName:"liliaSilverstone",
                                        content:"<p>Age: 25</p><p>Species: Therianthrope(Silver Wolf)</p><p>Address: 3400 N Clark Street</p><p>First confirmed user of NC-IOI-01 and confirmed Wild Magic conductor.</p><p>Silver-haired lycan therianthrope with increased strength and regenerative abilities. Appears to be the leader of the Wild Magic cult/coven operating within the area designated as the Northern Cascades. According to records published by the therianthropic group, she is in a close relationship with Stephanie Richardson. Then again, these individuals appear to bond with one-another like animals and, as such, any records of true romantic relations should be regarded with skepticism.</><p>Blood has been collected from this entity and is being used in testing to determine whether its properties can be used to augment human/canine operatives.</p>",
                                        commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities/liliaSilverstone: ',
                                        upstream:[]
                                    },
                                    {pageName:"stephanieRichardson",
                                        content:"<p>Age: N/A</p><p>Species: Therianthrope(River Otter)</p><p>Address:123 Granite Road, Second Floor</p><p>Second confirmed user of NC-IOI-01 and confirmed Wild Magic conductor.</p><p>Owner of the Roc Cafe and Coffee on the main street of Marble Basin. According to records she is 38 years old but visual documentation of the woman has shown her to be far younger. It is theorized that the Wild Magic release may have affected her physical age. An epigentic clock would provide definitive results but a complete autopsy would help to explain how certain bones/ligiments react to the process of de-aging.</p><p>Brother by the name of Jake Richardson was declared missing in 2021</p>",
                                        commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities/stephanieRichardson: ',
                                        upstream:[]
                                    },
                                    {pageName:"seraphinaBellweather",
                                        content:"<p>Age: 25</p><p>Species: Therianthrope(Northern Spotted Owl)</p><p>Address: 19 Rinnfeld Road</p><p>Owner of the local occult shop Wytches and confirmed Wild Magic conductor.</p><p>Family history of occultism has provided the individual with a greater knowledge of the unknown than others within the town. She has only started to study Wild Magic in earnest after her infection with therianthropy and is not to be considered much of a threat if forced into engagement. Is the primary author of the 'Fictional' supernatural romance series called Crimson Crescent Fang so as to pass information to individuals outside of Marble Basin. AI censroship tools have been put in place to prevent anything potentially harmful from leaking. In terms of artistic value, Crimson Crescent Fang is mediocre at best and it is doubtful the work will have any lasting impact.</p>",
                                        commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities/seraphinaBellweather: ',
                                        upstream:[]
                                    },
                                    {pageName:"gregKent",
                                        content:"<p>Age: 20</p><p>Species: RatRatRatRatRat</p><p>Address: He's In The Goddamn Walls</p><p>Fuck you guys, I am writing my own entry!</p><p>The Rat is easily one of the best hackers that is not currently owned by some bullshit corporation or government entity. The Rat works for whoever he wants, whenever he wants, and wherever her wants. Now that he is in the system, he's gonna crawl through your walls and take all your shit. Fuck with him or any of his buddies and a whole lot of radioactive documents are going to find themselves in very capable hands. In other words, I am the giant rat that makes all of the rules. Now let's see what kind of trouble we can get ourselves into.",
                                        commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/entities/gregKent: ',
                                        upstream:[]
                                        
                                    }
                                ]
                            },
                            {pageName:"ioi",
                                content:"<p>Now searching for Items of Interest within the Northern Cascades</p>",
                                commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/ioi: ',
                                upstream:[
                                    {pageName:"nc-IOI-01",
                                        content:"<p>NC-IOI-01 (Wilderness Fang) is a 4-inch long Machairodus fang with mossy cracks running across its length/width. The IOI provides its wielder with the ability to open up Wild Magic breaches with little effort. All one needs to do in order to activate the IOI is stab the length through a body part in one continuous motion. Upon extraction from the wound, the hole present within the user's body will become a breach through which Wild Magic will flow. The rapid transference of this Wild Magic through the human body tends to cause cases of therianthropy within the individual and thus allows them to channel Wild Magic even after the hole/breach has been healed</p><p>This item is not currently within the posession of the GBI and could pose a substantial risk should certain groups get their hands on it.</p><p>GBI scientists wish to examine the IOI and test its usage on non-human subjects whilst also studying what would happen should an individual be pierced with the IOI multiple times.</p>",
                                        commandLine:'[Admin@7.3.55.8][GPI_Base]northCascades/ioi/nc-IOI-01: ',
                                        upstream:[]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            {pageName:"gregThoughts",
                content:"<p>You are currently viewing the very ratty thoughts of the one and only Greg\nI'm an open book, baby. I don't mind.</p>",
                commandLine:"[Rat@Localhost~]Within_The_Rat_Den/gregThoughts: ",
                upstream:[
                    {pageName:'theGPI',
                        content:"<br><p>Who the Hell are these guys? They look like park rangers but Markus has no idea who any of them are. They won't even communicate with the guy and their security is INSANE. We are talking AES with a 256bit key levels of encryption. I'll break this shit wide open though. Rats can get into anything.</p><p>Finally! Paydirt! We are into the GPI and have access to a large portion of their files that cover the immediate Marble Basin area. Some files, like those created the rest of the pack and me, are hidden but can be entered so long as you understand the way in which these people label stuff. To test yourself out, try searching for my file.</p><p>Hint: My name is Greg Kent</p>",
                        commandLine:"[Rat@Localhost~]Within_The_Rat_Den/gregThoughts/theGPI: ",
                        upstream:[]
                    },
                    {pageName:'theWebsite',
                        content:"<br><p>Something strange is happening to the website.</p><p>When I go online to check how the servers/securities are holding up, I sometimes find that there are changes being made that are not of my own doing. Just the other day, Steph found references to her brother on the site, including some sort of audio that she had never heard before. She nearly beat the shit out of me thinking that I had set it all up as some kind of prank but I would never do that. I may be a Rat, but I am not a fucking asshole... Usually.</p><p>Anyway, so I went back into the HTML and tried to remove the reference but it came back every single time. The text is distorting but it's still easy to read using one of those 'descrambler' things online. Not sure if this is just some asshole from the GPI striking back at us for digging into their business or if that thing in the forest has found some way to connect to the server. Going to find out though.</p>",
                        commandLine:"[Rat@Localhost~]Within_The_Rat_Den/gregThoughts/theGPI: ",
                        upstream:[]
                    }
                ]
            }
        ]
    }
]

var currentLocation=theMap[0]
var previousLocations=[]


// set var and return input value
function getInput() {
    console.log
    command = commandInput.value;
    return command;
  }
  
  // construct the html+text of the input command
  function attachCommand() {
    // the command you entered
    var li = document.createElement('li');
    li.textContent = getInput();
    
    // the path
    var span = document.createElement('span');
    span.className = 'path';
    span.textContent = path;
    
    // attach path before command
    li.insertBefore(span,li.firstChild);
    
    // and attach to window
    result.appendChild(li);
  }
  
  // Checks to see if the response would allow movement through the site map
  function returnResponse() {
    var li = document.createElement('li');
    var answer=""
    var colletedResponse=getInput()
    if(colletedResponse.indexOf('sudo')===0){
        answer='<p id="error">Did you really think I would let sudo work in here?</p>'
    }else if(colletedResponse.indexOf('cd')===0){
        var direction=colletedResponse.split(' ')[1]
        if(direction===".."){
            currentLocation=previousLocations[previousLocations.length-1]
            previousLocations.pop()
            path=currentLocation.commandLine
            answer="<p id='movement'>You are moving to the "+currentLocation.pageName+"</p>"
            answer+=currentLocation.content
        } else {
            for(var j=0;j<currentLocation.upstream.length;j++){
                if(direction==currentLocation.upstream[j].pageName){
                    previousLocations.push(currentLocation)
                    currentLocation=currentLocation.upstream[j]
                    path=currentLocation.commandLine
                    answer="<p id='movement'>You are moving to the "+currentLocation.pageName+"</p>\n\n"
                    answer+=currentLocation.content
                    break
                }
            }
            if(typeof currentLocation.hidden!=='undefined'){
                console.log(currentLocation.hidden)
                for(var j=0;j<currentLocation.hidden.length;j++){
                    if(direction==currentLocation.hidden[j].pageName){
                        previousLocations.push(currentLocation)
                        currentLocation=currentLocation.hidden[j]
                        path=currentLocation.commandLine
                        answer="<p id='movement'>You are moving to the "+currentLocation.pageName+"</p>\n\n"
                        answer+=currentLocation.content
                        break
                    }
                }
            }
                
        }
    }else if(colletedResponse.indexOf('ls')===0){
        for(var i=0;i<currentLocation.upstream.length;i++){
            answer+="<li>"+currentLocation.upstream[i].pageName+"</li>"
        }
    }
    li.innerHTML = answer;
    
    // and attach to window
    result.appendChild(li);
  }
  
  // set input to last command on up key (see event listener below)
  function repeatInput() {
    commandInput.value = command;
  }
  
  // scroll to bottom...
  function scrollToBottom() {
    console.log(terminal.scrollTop)
    terminal.scrollTop = terminal.scrollHeight;
  }
  
  // run all functions on enter (see event listener below)
  function doTheThing() {
    if(getInput().trim() !== '') { // trim whitespace and check if empty
      attachCommand();
      returnResponse();
      scrollToBottom();
    }
    commandInput.value = ''; // clear input value 
  }
  
  // var hoisting transports this to the top
  var commandInput = document.getElementById('command-input'),
      result = document.querySelector('.result'),
      command = '',
      path = '[Root@Localhost~]Within_The_Rat_Den: ',
      terminal = document.querySelector('.terminal');

// whenever you press a key
commandInput.addEventListener('keydown',function(e){
    if(e.keyCode === 13) doTheThing(); // enter key
    if(e.keyCode === 38) repeatInput(); // up key
});